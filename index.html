<!DOCTYPE html>
<html>
<head>
  <title>MQTT Test with HiveMQ Cloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>
<body>
  <h2>MQTT Test ‚Üí HiveMQ Cloud</h2>
  <div id="status">Connecting...</div>
  <div id="log"></div>

  <script>
    // ==== HiveMQ Cloud Config ====
    const brokerHost = "1e1e9581694f459bba546a40c75d5445.s1.eu.hivemq.cloud"; // üëâ ‡πÉ‡∏™‡πà host ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const brokerPort = 8884;                        // ‡πÉ‡∏ä‡πâ WebSocket Secure (WSS)
    const topic = "tm/test";                        // topic ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
    const mqttUser = "Thinyyy";               // üëâ ‡πÉ‡∏™‡πà username ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const mqttPass = "Thiny0330";               // üëâ ‡πÉ‡∏™‡πà password ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    let client;

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á MQTT Client
    client = new Paho.MQTT.Client(brokerHost, brokerPort, "clientId-" + Math.random());

    // Callback ‡πÄ‡∏°‡∏∑‡πà‡∏≠ disconnect
    client.onConnectionLost = function(responseObject) {
      if (responseObject.errorCode !== 0) {
        log("‚ùå Connection lost: " + responseObject.errorMessage);
      }
    };

    // Callback ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤
    client.onMessageArrived = function(message) {
      log("üì• Received on " + message.destinationName + ": " + message.payloadString);
    };

    // Connect ‡πÑ‡∏õ‡∏¢‡∏±‡∏á HiveMQ Cloud
    client.connect({
      useSSL: true,
      userName: mqttUser,
      password: mqttPass,
      onSuccess: () => {
        log("‚úÖ Connected to HiveMQ Cloud");
        document.getElementById("status").innerText = "Connected ‚úÖ";

        // Subscribe ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å topic ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
        client.subscribe(topic);
        log("üì° Subscribed to topic: " + topic);

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° dummy ‡∏ó‡∏∏‡∏Å‡πÜ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(() => {
          if (client.isConnected()) {
            const msg = new Paho.MQTT.Message("Hello MQTT! " + new Date().toLocaleTimeString());
            msg.destinationName = topic;
            client.send(msg);
            log("üì§ Sent message to " + topic);
          }
        }, 3000);
      },
      onFailure: (e) => {
        log("‚ùå Failed to connect: " + e.errorMessage);
        document.getElementById("status").innerText = "Connect Failed ‚ùå";
      }
    });

    function log(message) {
      console.log(message);
      const logDiv = document.getElementById("log");
      logDiv.innerHTML = message + "<br>" + logDiv.innerHTML;
    }
  </script>
</body>
</html>

