<!DOCTYPE html>
<html>
<head>
  <title>MQTT HiveMQ Debug</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>
<body>
  <h2>MQTT HiveMQ Debug</h2>
  <div id="status">Connecting...</div>
  <div id="log"></div>

  <script>
    // ==== HiveMQ Config (‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) ====
    const brokerHost = "1e1e9581694f459bba546a40c75d5445.s1.eu.hivemq.cloud"; // ‡πÉ‡∏™‡πà host ‡∏à‡∏≤‡∏Å HiveMQ Cloud
    const brokerPort = 8884;                        // ‡πÉ‡∏ä‡πâ WSS
    const topic = "tm/test";
    const mqttUser = "Tinyyy";
    const mqttPass = "Tiny0330";

    let client = new Paho.MQTT.Client(brokerHost, brokerPort, "clientId-" + Math.random());

    client.onConnectionLost = function (responseObject) {
      log("‚ùå Connection lost: " + responseObject.errorMessage);
    };

    client.onMessageArrived = function (message) {
      log("üì• Received: " + message.payloadString);
    };

    client.connect({
      useSSL: true,
      userName: mqttUser,
      password: mqttPass,
      onSuccess: () => {
        log("‚úÖ Connected to HiveMQ Cloud");
        document.getElementById("status").innerText = "Connected ‚úÖ";
        client.subscribe(topic);
        log("üì° Subscribed to " + topic);

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥
        setInterval(() => {
          if (client.isConnected()) {
            let msg = new Paho.MQTT.Message("Hello MQTT @ " + new Date().toLocaleTimeString());
            msg.destinationName = topic;
            client.send(msg);
            log("üì§ Sent: " + msg.payloadString);
          }
        }, 5000);
      },
      onFailure: (err) => {
        log("‚ùå Connect failed: " + JSON.stringify(err));
        document.getElementById("status").innerText = "Connect Failed ‚ùå";
      }
    });

    function log(msg) {
      console.log(msg);
      document.getElementById("log").innerHTML = msg + "<br>" + document.getElementById("log").innerHTML;
    }
  </script>
</body>
</html>
